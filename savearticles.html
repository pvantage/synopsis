<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link href="css/style.css" type="text/css" rel="stylesheet" />
<link href="style.css" type="text/css" rel="stylesheet" />
<link href="css/main.css" type="text/css" rel="stylesheet" />
<style>
@import 'https://fonts.googleapis.com/css?family=Roboto:300,400,500,700';
</style>
<script src="js/jquery.min.js"></script>
<link rel="stylesheet" href="css/bootstrap.min.css"/>
<script src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/jquery.touchSwipe.min.js"></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script src='js/responsivevoice.js'></script>
<!--<script type="text/javascript" src="js/dbtables.js"></script>-->
<script>
jQuery(document).ready(function(){
    jQuery(".menu_box").click(function(){
        jQuery(".menusection").toggle();
    });
});
</script>
<script type="text/javascript">


jQuery(document).ready(function(){
	document.addEventListener("deviceready", function(){jQuery('#device_id').val(device.uuid); }, false);
	
	jQuery( document ).on( "mobileinit", function() {
		jQuery.mobile.allowCrossDomainPages = true;
	});
	var contentType ="application/x-www-form-urlencoded; charset=utf-8";
    if(window.XDomainRequest){contentType = "text/plain";}
	jQuery.support.cors = true;
	var location='';
	/*db.transaction(function (tx) {
		tx.executeSql("SELECT * FROM NEWSSETTINGS where meta_key='countrycode'", [],
			function(tx,results){
				if(typeof results.rows.item(0).meta_value != 'undefined'){
					location=results.rows.item(0).meta_value;
				}
			
		}, errorCB);
	});*/
	

	var html='<div class="bodyoverlay"></div><div class="preloader"></div>';
	jQuery('body').append(html);
	var cid_array = localStorage.getItem('bookmarked');
	
	setTimeout(function(){
		var device_id=jQuery('#device_id').val();
		
		var url=siteurl+'/api/bookmarked.php';
		var uid=gup('uid');
		var cid=gup('cid');
		checkloggedin(uid);
		var page=1;
		
		savenews=function(row){
				db.transaction(function (tx) {
			
					tx.executeSql("SELECT * FROM NEWS where newid='"+id+"'", [],
					function(tx,results){
						if(typeof results.rows.item(0).id == 'undefined'){
							var sql="INSERT INTO NEWS (newid,title,summary,news_url,news_source,published_by,video,image,share_url,post_date,like,readed,bookmark) VALUES('"+row['id']+"','"+row['title']+"','"+row['summary']+"','"+row['news_url']+"','"+row['news_source']+"','"+row['published_by']+"','"+row['video']+"','"+row['image']+"','"+row['share_url']+"','"+row['post_date']+"','"+row['news_like']+"','"+row['readed']+"','0')";
							tx.executeSql(sql,[],function(){},errorCB);
						}
						
					}
					, errorCB);
					
					
				});
				
		},
		savetobookmark=function(){
			jQuery('.activenews a.bookmarks').click(function(){
				var $this=jQuery(this);
				var url2=siteurl+'/api/like.php';
				var id=jQuery(this).attr('coords');
				var bookmarked = '';
				if(localStorage.getItem('bookmarked') != null){	   
				   bookmarked = localStorage.getItem('bookmarked');	
				   	
				}
				if(!jQuery(this).hasClass('bookedmarked'))
				{
					if(localStorage.getItem('bookmarked') == null){	   
					   var bookmarked = id;		
					}else{		
						var bookmarked = localStorage.getItem('bookmarked')+','+id;
					}
					jQuery(this).addClass('bookedmarked');
				}
				else
				{
					var bookmarked2=bookmarked.split(',');
					var index=bookmarked2.indexOf(id);
					if(parseInt(index)>=0)
					{
						bookmarked2.splice(index, 1);
						
						if(parseInt(bookmarked2.length)>0){
							var bookmarked='';
							for(i=0;i<bookmarked2.length;i++)
							{
								if(i=='0')
								{
									bookmarked=bookmarked2[i];
								}
								else
								{
									bookmarked=bookmarked+','+bookmarked2[i];
								}
							}
						}
						else
						{
							bookmarked=0;
						}
						//unreadnews = localStorage.getItem('bookmarked')+','+jQuery(this).next('div').attr('news-id');
					}
					jQuery(this).removeClass('bookedmarked');
				}
				localStorage.setItem('bookmarked', bookmarked);
				
				/*db.transaction(function (tx) {
			
					tx.executeSql("SELECT * FROM NEWS where newid='"+id+"'", [],
					function(tx,results){
						if(typeof results.rows.item(0).bookmark != 'undefined'){
							if(results.rows.item(0).bookmark=='0')
							{
								var sql="UPDATE NEWS SET bookmark='1' WHERE newid='"+id+"'";
								tx.executeSql(sql,[],function(){},errorCB);
							}
							else
							{
								var sql="UPDATE NEWS SET bookmark='0' WHERE newid='"+id+"'";
								tx.executeSql(sql,[],function(){},errorCB);
							}
						}
						
					}
					, errorCB);
					
					
				});*/
				
			});
		},
		likenews=function(){
			jQuery('.activenews a.likethis').click(function(){
				var $this=jQuery(this);
				var url2=siteurl+'/api/like.php';
				var id=jQuery(this).attr('coords');
				jQuery.ajax({ 
				 type: 'POST',  
				 url: url2,  
				 dataType: 'json',  
				 data: {device_id:device_id,id:id},  
				 crossDomain: true,  
				 beforeSend: function() {
				 },		
				 complete: function() {
					
				 },
				 success: function(res) {  
					if(parseInt(res['total_like'][0]['count'])>=0)
					{
						
						if(res['total_like'][0]['news_like']){
							jQuery($this).addClass('liked');
						}else{jQuery($this).removeClass('liked');}
						
						
						var likes=' Like';
						if(parseInt(res['total_like'][0]['count'])>0){
							likes=res['total_like'][0]['count']+' Like';
							if(parseInt(res['total_like'][0]['count'])>1){
								likes=res['total_like'][0]['count']+' Likes';
							}
						}
						
						jQuery($this).html('<img src="images/like.png"> '+likes);
					}
					
				 },  
				 error: function(response, d, a){
					
				 } 
			   });
			});
		},
		loadagainnews=function(){
			jQuery('a.loadnewnews').click(function(){
				jQuery('.header_right_news').html('<a href="javascript:;" class="loadnewnews"><img src="images/ajax-loading.gif"></a>');
					setTimeout(function(){
						jQuery('.newsection').removeClass('latestnews');
						jQuery('.newsection').removeClass('activenews');
						jQuery('.newsection:first').addClass('activenews');
						var th=jQuery('.activenews');
						swipnews(th);
						jQuery('.header_right_news').html('<a href="javascript:;" class="loadnewnews"><img src="images/221.png"></a>');
						loadagainnews();
					},1000);
			});
		},
		swipnews=function(th){
			jQuery(th).swipe( {
				//Generic swipe handler for all directions
				swipe:function(event, direction, distance, duration, fingerCount, fingerData) {
					responsiveVoice.cancel();
					jQuery('.activenews a.speakthis').removeClass('activespeach');
					//console.log( direction );
					if(direction=='up'){
						if(localStorage.getItem('unreadnews') == null){	   
						   var unreadnews = jQuery(this).attr('news-id');		
						}else{		
							var unreadnews = localStorage.getItem('unreadnews')+','+jQuery(this).attr('news-id');
						}
						unreadnews2=unreadnews.split(',');
						var newxtnewsid=jQuery(this).next('div').attr('news-id');
						if(parseInt(unreadnews2.indexOf(newxtnewsid))<0)
						{
							unreadnews = localStorage.getItem('unreadnews')+','+jQuery(this).next('div').attr('news-id');
						}
						localStorage.setItem('unreadnews', unreadnews);
						if(jQuery(this).next('div').hasClass('newsection'))
						{
							jQuery(this).next('div').addClass('activenews');
							jQuery(this).slideUp(500,function(){
								jQuery('.newsection').removeAttr('style');jQuery(this).removeClass('activenews');
								th=jQuery('.activenews');
								swipnews(th);
								
								var lastnewsid=jQuery('.allnews .newsection:first').attr('news-id');
								var lastnewsid2=jQuery('.allnews .activenews').attr('news-id');
								if(lastnewsid!=lastnewsid2){
									jQuery('.header_right_news').html('<a href="javascript:;" class="gototopnews"><img src="images/toparrow.png"></a>');
								}
								else
								{
									jQuery('.header_right_news').html('<a href="javascript:;" class="loadnewnews"><img src="images/221.png"></a>');
									loadagainnews();
								}
								jQuery('a.gototopnews').click(function(){
									jQuery("html, body").animate({ scrollTop: 0 }, 1000,function(){
										if(jQuery('.allnews .latestnews:last').next('div').hasClass('newsection'))
										{
											jQuery('.allnews .latestnews:last').next('.newsection').addClass('activenews');
											jQuery('.newsection').removeClass('activenews');
										}
										else
										{
											jQuery('.newsection').removeClass('activenews');
											jQuery('.allnews .newsection:first').addClass('activenews');
										}
										jQuery('.header_right_news').html('<a href="javascript:;" class="loadnewnews"><img src="images/221.png"></a>');
										loadagainnews();
									});
								});
								
								
							});
							
						}
						
						
					}
					else if(direction=='down'){
						if(jQuery(this).prev('div').hasClass('newsection'))
						{
							jQuery(this).prev('div').addClass('activenews');
							jQuery(this).slideDown(1000,function(){
								jQuery('.newsection').removeAttr('style');
								jQuery(this).removeClass('activenews');
								th=jQuery('.activenews');
								swipnews(th);
							});
							/*jQuery(this).animate({
								height: "100px"
							}, 2000, "swing", function(){
								jQuery('.newsection').removeAttr('style');
								jQuery(this).removeClass('activenews');
								th=jQuery('.activenews');
								swipnews(th);
							});*/
							
						}
						
						var lastnewsid=jQuery('.allnews .newsection:first').attr('news-id');
						var lastnewsid2=jQuery('.allnews .activenews').attr('news-id');
						if(lastnewsid==lastnewsid2){
							jQuery('.header_right_news').html('<a href="javascript:;" class="loadnewnews"><img src="images/221.png"></a>');
							loadagainnews();
						}
					}
					likenews();
					savetobookmark();
					sharenews();
					jQuery('.activenews .new_detail_section, .activenews .new_des_content').click(function(){
						jQuery("header").toggle();
					});
					jQuery('.activenews a.speakthis').click(function(){
						var sptext=jQuery(this).attr('data');
						if(jQuery(this).hasClass('activespeach'))
						{
							responsiveVoice.cancel();
							jQuery(this).removeClass('activespeach');
						}
						else
						{
							responsiveVoice.speak(sptext);
							jQuery(this).addClass('activespeach');
						}
						return false;
					});
				}
				
			});
		},
		sharenews=function(){
			jQuery('.activenews a.sharenews').click(function(){
				var title=jQuery(this).attr('data-title');
				var durl=jQuery(this).attr('data-url');
				var dtext=jQuery(this).attr('data-text');
				var dimg=jQuery(this).attr('data-img');
				dtext="Save time. Download Synopsis,It's highest rated news app, to read news in 80 words.";
				//alert(dtext);
				window.plugins.socialsharing.share(dtext,title,dimg,durl);
			});
		},
		
		loadnews=function(page){
			jQuery.ajax({ 
			 type: 'POST',  
			 url: url,  
			 dataType: 'json',  
			 data: {cid_array:cid_array,location:location,device_id:device_id, page:page,news_action:'unread'},  
			 crossDomain: true,  
			 beforeSend: function() {
			 },		
			 complete: function() {
				
				jQuery('body .preloader').remove();
				jQuery('body .bodyoverlay').remove();
				
				page=parseInt(page)+1;	
				if(page!='1'){
				setTimeout(function(){
				 loadnews(page);
				},1000);
				}
				
				
			 },
			 success: function(res) {  
				if(typeof res['news'][0]['id']!='undefined')
				{
					var html='';
					jQuery(res['news']).each(function(i){
						var img='null';
						html+='<div class="newsection" news-id="'+res['news'][i]['id']+'"><div class="container"><div class="new_detail_section">';
						if(res['news'][i]['video']!='')
						{
							html+='<div class="new_video"><img src="images/new_img.png"/></div><div class="new_video_icon"><a href="#"><img src="images/video_icon.png"/></a></div>';
						}
						else if(res['news'][i]['image']!='')
						{
							html+='<div class="new_video"><img src="'+res['news'][i]['image']+'"/></div>';
							img=res['news'][i]['image'];
						}
						else
						{
							html+='<div class="new_video"><img src="images/aaa.png"/></div>';
						}
						
						var mystring=res['news'][i]['summary'];
						mystring = mystring.replace(/["']/g, "");
						var mytitle=res['news'][i]['title'];
						mytitle = mytitle.replace(/["']/g, "")+'. ';
						var liked='';
						if(res['news'][i]['like_status']){
							liked=' liked';
						}
						
						bookmark = localStorage.getItem('bookmarked');
						var bookmcls='';
						if(bookmark!=null){
							var bookmark2=bookmark.split(',');
							var index=bookmark2.indexOf(res['news'][i]['id']);
							if(parseInt(index)>=0)
							{
								bookmcls=' bookedmarked';
							}
						}
						
						var likes=' Like';
						if(parseInt(res['news'][i]['news_like'])>0){
							likes=res['news'][i]['news_like']+' Like';
							if(parseInt(res['news'][i]['news_like'])>1){
								likes=res['news'][i]['news_like']+' Likes';
							}
						}
						
						html+='</div><div class="news_description"><div class="news_des_section"><div class="new_heading"><a href="javascript:;" class="bookmarks'+bookmcls+'" coords="'+res['news'][i]['id']+'">'+res['news'][i]['title']+'</a></div><div class="volume_box"><a href="javascript:;" class="speakthis" data="'+mytitle+mystring+'"> <img src="images/volume.png"/> Listen </a></div></div><div class="new_des_content">'+res['news'][i]['summary']+'<div class="shortby"><strong>short</strong> <span>by Synopsis Team</span></div></div></div></div><footer class="afterlogin"><div class="footer_section"><div class="likebox"><ul><li><a class="likethis'+liked+'" href="javascript:;" coords="'+res['news'][i]['id']+'"><img src="images/like.png"/>'+likes+'</a></li><li><a href="javascript:;" class="sharenews" data-title="'+res['news'][i]['title']+'" data-url="'+res['news'][i]['share_url']+'" data-img="'+img+'" data-text="'+mystring+'"><img src="images/share.png"/> Share</a></li></ul></div><hr><div class="ftr_logo"><img src="images/footerlogo.png"/></div><div class="source">more at <a href="'+res['news'][i]['news_url']+'">'+res['news'][i]['news_source']+'</a></div></div></footer><div class="clearfix"></div></div>';
						if(page==1){res['news'][i]['readed']=1;}else{res['news'][i]['readed']=0;}
						//savenews(res['news'][i]);
						
					});
					jQuery('.allnews').append(html);
					if(!jQuery('.newsection').hasClass('activenews'))
					{
						jQuery('.newsection:first').addClass('activenews');
					}
					
					var th=jQuery('.activenews');
					swipnews(th);
					
					
					if(page==1){
						jQuery('.header_right_news').html('<a href="javascript:;" class="loadnewnews"><img src="images/221.png"></a>');
						loadagainnews();
						jQuery('.activenews a.speakthis').click(function(){
							var sptext=jQuery(this).attr('data');
							if(jQuery(this).hasClass('activespeach'))
							{
								responsiveVoice.cancel();
								jQuery(this).removeClass('activespeach');
							}
							else
							{
								responsiveVoice.speak(sptext);
								jQuery(this).addClass('activespeach');
							}
							return false;
						});
						jQuery('.activenews .new_detail_section, .activenews .new_des_content').click(function(){
							jQuery("header").toggle();
						});
						savetobookmark();
						likenews();
						sharenews();
					}
				}
				else
				{
					page=0;
				}
				
			 },  
			 error: function(response, d, a){
				
			 } 
		   });
		   
		}
		
		if(cid_array!=null && cid_array!='0')
		{
			loadnews(page);
		}
		else
		{
			jQuery('body .preloader').remove();
			jQuery('body .bodyoverlay').remove();
			jQuery("header").show();
			jQuery('.allnews').html('<div style="padding-top:55px; padding-left:5px;">There is no saved news.</div>');
		}
		var th=jQuery('.activenews');
		swipnews(th);
	 },500);  
});		
</script>
<title>Synopsis</title>
</head>
<body>
<div class="wrapper">
  <header style="display:none;">
    <div class="header_box">
      <div class="header_logo_section">
        <div class="menu_box"> <a href="#"><img class="mnu" src="images/menu.png"/>
          <div class="logobox"> <img src="images/logo.png" /> </div>
          </a></div>
      </div>
      <div class="header_right_news"> <!--1052 News <a href="#"><img src="images/imgtotlenews.png"/></a>--> </div>
      <div class="clr"></div>
      
    </div>
    <div class="container menusection">
      <div class="category_section">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#home">Categories</a></li>
          <li><a href="#menu1">Settings</a></li>
        </ul>
        <div class="tab-content">
          <script type="text/javascript">document.write(sitemenus());</script>
        </div>
      </div>
    </div>
  </header>
  <div class="allnews"></div>
  
</div>
<script>
jQuery(document).ready(function(){
    jQuery(".nav-tabs a").click(function(){
        jQuery(this).tab('show');
    });
	jQuery('.new_detail_section, .new_des_content').click(function(){
        jQuery("header").toggle();
    });
});
</script>
<input type="hidden" id="device_id" value="localhost">
</body>
</html>
